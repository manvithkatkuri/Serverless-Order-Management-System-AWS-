openapi: 3.0.1
info:
  title: Order System API
  version: "1.0"
paths:
  /orders:
    options:
      summary: CORS support
      responses:
        "200":
          description: Default response for CORS
          headers:
            Access-Control-Allow-Origin: { schema: { type: string } }
            Access-Control-Allow-Headers: { schema: { type: string } }
            Access-Control-Allow-Methods: { schema: { type: string } }
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: '{"statusCode": 200}'
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,POST'"
    post:
      summary: Create order
      security:
        - api_key: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOrderRequest"
      responses:
        "200":
          description: Created
      x-amazon-apigateway-integration:
        httpMethod: POST
        type: aws_proxy
        uri: "arn:aws:apigateway:${region}:lambda:path/2015-03-31/functions/${create_order_arn}/invocations"
    get:
      summary: List orders (optional status query)
      security:
        - api_key: []
      parameters:
        - name: status
          in: query
          schema: { type: string }
          required: false
      responses:
        "200":
          description: OK
      x-amazon-apigateway-integration:
        httpMethod: POST
        type: aws_proxy
        uri: "arn:aws:apigateway:${region}:lambda:path/2015-03-31/functions/${list_orders_arn}/invocations"

  /orders/{id}:
    options:
      summary: CORS support
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Default response for CORS
          headers:
            Access-Control-Allow-Origin: { schema: { type: string } }
            Access-Control-Allow-Headers: { schema: { type: string } }
            Access-Control-Allow-Methods: { schema: { type: string } }
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: '{"statusCode": 200}'
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET'"
    get:
      summary: Get order by id
      security:
        - api_key: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
      x-amazon-apigateway-integration:
        httpMethod: POST
        type: aws_proxy
        uri: "arn:aws:apigateway:${region}:lambda:path/2015-03-31/functions/${get_order_arn}/invocations"

components:
  securitySchemes:
    api_key:
      type: apiKey
      name: x-api-key
      in: header
  schemas:
    CreateOrderRequest:
      type: object
      required: [customerEmail, items, totalAmount]
      properties:
        customerEmail: { type: string }
        items:
          type: array
          items:
            type: object
            required: [sku, qty]
            properties:
              sku: { type: string }
              qty: { type: integer, minimum: 1 }
        totalAmount: { type: number, minimum: 0 }
